import {format_date} from "./util/util";
import type {CorsProxyBody, KITEvent, KITEventsConfig} from "./types";
import {END_TIMES} from "./types";
import {Parser} from "./parser";

const CORS_PROXY_SERVER = "https://cors.taptwice.dev/request";
const BASE_URL = "https://campus.kit.edu/sp/campus/all/extendedSearch.asp";
const TERMS_URL = "https://campus.kit.edu/sp/server/services/kit/terms.asp";

const REQUEST_HEADERS = {
    'authority': 'campus.kit.edu', 'method': 'POST',
    'path': '/sp/campus/all/extendedSearch.asp', 'scheme': 'https',
    'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',
    'accept-encoding': 'gzip, deflate, br',
    'accept-language': 'en,en-US;q=0.9,de;q=0.8,da;q=0.7,zh-CN;q=0.6,zh;q=0.5,es;q=0.4',
    'cache-control': 'max-age=0', 'content-length': '452',
    'content-type': 'application/x-www-form-urlencoded',
    'cookie': 'session-campus-prod-sp=AWTAQSQRENGKPJNCGGLNAHJHCLCEPAMC',
    'origin': 'https://campus.kit.edu',
    'referer': 'https://campus.kit.edu/sp/campus/all/extendedSearch.asp',
    'sec-ch-ua': '"Google Chrome";v="107", "Chromium";v="107", "Not=A?Brand";v="24"',
    'sec-ch-ua-mobile': '?0', 'sec-ch-ua-platform': '"Windows"', 'sec-fetch-dest': 'iframe',
    'sec-fetch-mode': 'navigate', 'sec-fetch-site': 'same-origin', 'sec-fetch-user': '?1',
    'upgrade-insecure-requests': '1',
    'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64;x64) AppleWebKit / 537.36(KHTML, like Gecko) Chrome / 107.0.0.0 Safari / 537.36',
};

const DEFAULT_FORM_DATA = {
    'search': 'Suchen',
    'tguid': '', // This gets replaced by the correct term id
    'appointmentdate': '',
    'appointmenttimestart': '',
    'appointmenttimeend': '',
    'pagesize': 500,
    'room': {}
}

const test_html = `
<!DOCTYPE html><html lang="de" lang="de" xmlns="http://www.w3.org/1999/xhtml"><head><title>Erweiterte Suche nach Veranstaltungen</title><meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="shortcut icon" type="image/x-icon" href="../../custom/kit/img/favicon.ico" /><link rel="stylesheet" type="text/css" media="screen, projection" href="../../custom/shared/css/jquery-ui-1.11.4.min.css?v=20230314" /><link rel="stylesheet" type="text/css" media="screen, projection" href="../../custom/kit/css/new/gui_layout.css?v=20230314" /><link rel="stylesheet" type="text/css" media="screen, projection" href="../../custom/kit/css/new/basic_styles.css?v=20230314" /><link rel="stylesheet" type="text/css" media="screen, projection" href="../../custom/kit/css/new/content_layout.css?v=20230314" /><link rel="stylesheet" type="text/css" media="print" href="../../custom/kit/css/new/print_layout.css?v=20230314" /><link rel="stylesheet" type="text/css" media="screen, projection" href="../../custom/kit/css/new/kit.iframe.css?v=20230314" /><script type="text/javascript">var CAMPUS = {};</script><script type="text/javascript" src="../../custom/shared/js/i18n.js.asp?lang=de&amp;v=20230314"></script><script type="text/javascript" src="../../custom/shared/js/config.js.asp?tguid=0x40B784B43AED4CC9857335104533EDFB&amp;v=20230314"></script><script type="text/javascript" src="../../custom/shared/js/jquery-3.6.0.min.js?v=20230314"></script><script type="text/javascript" src="../../custom/shared/js/jquery-ui-1.12.1.min.js?v=20230314"></script><script type="text/javascript" src="../../custom/shared/js/campus.js?v=20230314"></script><script type="text/javascript" src="../../custom/shared/js/ajax.js?v=20230314"></script><script type="text/javascript" src="../../custom/shared/js/hierarchical-InputAssistance.js?v=20230314"></script><script type="text/javascript" src="../../custom/shared/js/table.js?v=20230314"></script><script type="text/javascript" src="../../custom/kit/js/URI.js?v=20230314"></script><script type="text/javascript" src="../../custom/kit/js/kit.js?v=20230314"></script><script type="text/javascript" src="../../custom/kit/js/kit.iframe.js?v=20230314"></script><script type="text/javascript" src="../../custom/kit/js/iframeResizer.contentWindow.js?v=20230314"></script></head><body class="extern"><form class="contentForm" action="extendedSearch.asp" method="POST" name="casform"><div class="content"><a id="topanchor" name="topanchor"></a><h1 class="pagetitle">Erweiterte Suche nach Veranstaltungen</h1><div class="menubar"><div class="menuitem"><button type="submit" name="search" rel="" value="Suchen" title="Suchen"><img width="16" height="16" src="../../custom/shared/img/search_2_24.png" alt="Suchen" />Suchen</button></div><div class="menuitem"><button type="submit" name="printpage" rel="" id="printpage" value="Drucken" title="Drucken"><img width="16" height="16" src="../../custom/shared/img/print_24.png" alt="Drucken" />Drucken</button></div></div><script type="text/javascript" src="../../custom/kit/js/magicsuggest.js"></script><script type="text/javascript" src="../../custom/kit/js/extendedSearch.js"></script><style type="text/css">div.content{ min-height:600px }</style><input type="hidden" name="tguid" value="0x40B784B43AED4CC9857335104533EDFB"></input><input type="hidden" name="searchid" value="003127481831"></input><div class="formcomponent"><p>Mit der erweiteren Suche nach Veranstaltungen können Sie gezielt nach Veranstaltungen im aktuell ausgewählten Sommersemester 2023 suchen. Bitte legen Sie in den folgenden Feldern die gewünschten Suchparameter fest und klicken Sie auf "Suchen". Bitte beachten Sie, dass nicht mehr als 200 Veranstaltungen als Ergebniss der Suche angezeigt werden können.</p></div><div class="formcomponent grid-layout-2col"><div class="grid-column"><div class="field" id="coursenumber-field"><div class="label"><label for="coursenumber">Veranstaltungsnr.:</label></div><div class="element"><input type="text" name="eventcoursenumber" id="coursenumber" value="" maxlength="" size=""></input></div></div><div class="field" id="title-field"><div class="label"><label for="title">Titel:</label></div><div class="element"><input type="text" name="eventtitle" id="title" value="" maxlength="" size=""></input></div></div><div class="field" id="type-field"><div class="label"><label for="type">Veranstaltungsart:</label></div><div class="element"><select id="type" name="eventtype" size="1"><option selected="selected"></option><option value="Block (B)">Block</option><option value="Exkursion (EXK)">Exkursion</option><option value="Hauptseminar (HS)">Hauptseminar</option><option value="Klausur">Klausur</option><option value="Kolloquium (KOL)">Kolloquium</option><option value="Kurs (Ku)">Kurs</option><option value="Praktikum (P)">Praktikum</option><option value="Oberseminar (OS)">Oberseminar</option><option value="Projekt (PRO)">Projekt</option><option value="Proseminar (PS)">Proseminar</option><option value="Seminar (S)">Seminar</option><option value="Sonstige (sonst.)">Sonstige</option><option value="Sprechstunde (Sprechst.)">Sprechstunde</option><option value="Tagesworkshop (TW)">Tagesworkshop</option><option value="Tutorium (Tu)">Tutorium</option><option value="Übung (Ü)">Übung</option><option value="Vorlesung (V)">Vorlesung</option><option value="Vorlesung / Übung (VÜ)">Vorlesung / Übung</option><option value="Prüfung (PR)">Prüfung</option></select></div></div><div class="field" id="type-field"><div class="label"><label for="type">Veranstaltungsform:</label></div><div class="element"><select id="type" name="eventformat" size="1"><option selected="selected"></option><option value="Präsenz">Präsenz</option><option value="Online">Online</option><option value="Präsenz/Online gemischt">Präsenz/Online gemischt</option><option value="Abgesagt">Abgesagt</option></select></div></div><div class="field" id="language-field"><div class="label"><label for="language">Sprache:</label></div><div class="element"><select id="language" name="eventlanguage" size="1"><option selected="selected"></option><option value="Deutsch">Deutsch</option><option value="Englisch">Englisch</option><option value="Deutsch/Englisch">Deutsch/Englisch</option><option value="Französisch">Französisch</option></select></div></div><div class="field" id="appointment-period-field"><div class="label"><label for="appointment-period">Termin:</label></div><div class="element"><select name="appointmentperiod" size="1" id="appointment-period"><option selected="selected"></option><option value="7">Wöchentlicher Termin</option><option value="14">14-tgl. Termin</option><option value="1">Einmaliger Termin</option><option value="-1">Ohne Termine</option></select></div></div><div class="field" id="appointment-weekday-field"><div class="label"><label for="appointment-weekday">Wochentag:</label></div><div class="element"><select name="appointmentweekday" size="1" id="appointment-weekday"><option selected="selected"></option><option value="1">Montag</option><option value="2">Dienstag</option><option value="3">Mittwoch</option><option value="4">Donnerstag</option><option value="5">Freitag</option><option value="6">Samstag</option><option value="7">Sonntag</option></select></div></div><div class="field" id="appointment-date-field"><div class="label">Datum:</div><div class="element"><input type="text" name="appointmentdate" id="appointment-date" class="datefield termdate" maxlength="10" placeholder="TT.MM.JJJJ" value="21.04.2023"></input></div></div><div class="field" id="appointment-time-field"><div class="label">Zeit:</div><div class="element"><input type="text" name="appointmenttimestart" id="appointment-timestart" class="timefield" maxlength="5" placeholder="hh:mm"></input> -
          <input type="text" name="appointmenttimeend" id="appointment-timeend" class="timefield" maxlength="5" placeholder="hh:mm"></input></div></div><div class="field" id="elearning-field"><div class="label">E-Learning:</div><div class="element"><p><input type="checkbox" name="workspace" id="workspace" value="true"></input><label for="workspace">ILIAS-Kurs</label></p><p><input type="checkbox" name="recording" id="recording" value="true"></input><label for="recording">Vorlesungsaufzeichnung</label></p><p><input type="checkbox" name="translator" id="translator" value="true"></input><label for="translator">Lecture Translator</label></p></div></div></div><div class="grid-column"><div class="field" id="product-field"><div class="label">Studiengänge:</div><div class="element"><input name="product" type="hidden" value="{}"></input><div class="multiselect-autocomplete" data-name="product" data-type="product" data-placeholder="Studiengang suchen"></div></div></div><div class="field" id="module-field"><div class="label">Module:</div><div class="element"><input name="module" type="hidden" value="{}"></input><div class="multiselect-autocomplete" data-name="module" data-type="module" data-placeholder="Modul suchen"></div></div></div><div class="field" id="brick-field"><div class="label">Teilleistungen:</div><div class="element"><input name="brick" type="hidden" value="{}"></input><div class="multiselect-autocomplete" data-name="brick" data-type="brick" data-placeholder="Teilleistung suchen"></div></div></div><div class="field" id="audience-field"><div class="label">Hörerkreise:</div><div class="element"><input name="audience" type="hidden" value="{}"></input><div class="multiselect-autocomplete" data-name="audience" data-type="audience" data-placeholder="Hörerkreis suchen"></div></div></div><div class="field" id="field-field"><div class="label">VVZ-Überschriften:</div><div class="element"><input name="field" type="hidden" value="{}"></input><div class="multiselect-autocomplete" data-name="field" data-type="heading" data-placeholder="VVZ-Überschrift suchen"></div></div></div><div class="field" id="unit-field"><div class="label">Einrichtungen:</div><div class="element"><input type="hidden" name="unit" value="{}"></input><div class="multiselect-autocomplete" data-name="unit" data-type="unit" data-placeholder="Einrichtung suchen"></div></div></div><div class="field" id="room-field"><div class="label">Räume:</div><div class="element"><input type="hidden" name="room" value="{&quot;0x8352C75F466935449E9A7EA607302CD0&quot;:&quot;30.95 Forum H\u00F6rsaal (Audimax)&quot;}"></input><div class="multiselect-autocomplete" data-name="room" data-type="room" data-placeholder="Raum suchen"></div></div></div><div class="field" id="lecturer-field"><div class="label">Dozent/innen:</div><div class="element"><input type="hidden" name="lect" value="{}"></input><div class="multiselect-autocomplete" data-name="lect" data-type="address" data-placeholder="Dozent/in suchen"></div></div></div></div></div><input type="hidden" name="view" value="list" /><div class="tabbar"><div class="tab-wrapper"><a id="tab-list" class="tab tab-active" href="extendedSearch.asp?searchid=003127481831&amp;view=list&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Veranstaltungsliste</a><a id="tab-term" class="tab" href="extendedSearch.asp?searchid=003127481831&amp;view=term&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Semesteransicht</a><a id="tab-app" class="tab" href="extendedSearch.asp?searchid=003127481831&amp;view=app&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Terminliste</a></div></div><div id="tab-container-list" class="tab-container"><script type="text/javascript">var EVENTLISTconstraintMap = {
};
</script><div class="templatecomponent"><a class="anchor" name="EVENTLIST" tabindex="10000">.</a><h2 class="table-caption">Veranstaltungen</h2><div class="pagination"><div class="pagination-count">Einträge 1 - 8 von 8</div><div class="pagination-itemsperpage"><select class="itemsperpage" size="1" name="pagesize"><option value="10">10</option><option value="25" selected="selected">25</option><option value="50">50</option><option value="100">100</option><option value="200">200</option></select> Einträge pro Seite</div></div><div class="table-container"><table class="listview" id="EVENTLIST"><tbody class="tablehead"><tr class="folding-all-close"><th class="folding-button-cell"><div class="folding-button"></div></th><th title="" class="minwidth nowrap"><span class="nowrap">LV-Nr.</span><div class="sort"><button class="sort-up sort-active" data-sortcolumn="1" data-sortorder="up" disabled="disabled" title="aufwärts sortieren"> </button><button class="sort-down" data-sortcolumn="1" data-sortorder="down" title="abwärts sortieren"> </button></div></th><th title="" class="rwev_titleger"><span class="nowrap">Titel</span><div class="sort"><button class="sort-up" data-sortcolumn="2" data-sortorder="up" title="aufwärts sortieren"> </button><button class="sort-down" data-sortcolumn="2" data-sortorder="down" title="abwärts sortieren"> </button></div></th><th title="" class="nomobile"><span class="nowrap">Dozent/innen</span></th><th title="" class="nomobile"><span class="nowrap">Art</span><div class="sort"><button class="sort-up" data-sortcolumn="3" data-sortorder="up" title="aufwärts sortieren"> </button><button class="sort-down" data-sortcolumn="3" data-sortorder="down" title="abwärts sortieren"> </button></div></th><th title="" class="nowrap mobileonly"><span class="nowrap">Art</span><div class="sort"><button class="sort-up" data-sortcolumn="4" data-sortorder="up" title="aufwärts sortieren"> </button><button class="sort-down" data-sortcolumn="4" data-sortorder="down" title="abwärts sortieren"> </button></div></th><th title="" class="nomobile"><span class="nowrap">Form</span><div class="sort"><button class="sort-up" data-sortcolumn="15" data-sortorder="up" title="aufwärts sortieren"> </button><button class="sort-down" data-sortcolumn="15" data-sortorder="down" title="abwärts sortieren"> </button></div></th><th title="" class="nowrap mobileonly"><span class="nowrap">Form</span><div class="sort"><button class="sort-up" data-sortcolumn="16" data-sortorder="up" title="aufwärts sortieren"> </button><button class="sort-down" data-sortcolumn="16" data-sortorder="down" title="abwärts sortieren"> </button></div></th><th title="" class="icon"><span class="nowrap"></span></th></tr></tbody><tbody class="tablecontent"><tr id="0x29D0DDFC96DF4515B39D05C5C76A423F" class="odd folding-close"><td class="folding-button-cell"><div class="folding-button"></div></td><td class="minwidth nowrap"><a href="../../campus/all/event.asp?gguid=0x29D0DDFC96DF4515B39D05C5C76A423F&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">1130022</a></td><td class="rwev_titleger"><a href="../../campus/all/event.asp?gguid=0x29D0DDFC96DF4515B39D05C5C76A423F&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">KIT Konzertchor</a></td><td class="nomobile"><a href="../all/lecturer.asp?gguid=0xDD9829BD697CA34389E8B7BE78D2FAB7">Indlekofer</a></td><td class="nomobile"><a href="../../campus/all/event.asp?gguid=0x29D0DDFC96DF4515B39D05C5C76A423F&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Praktische Übung</a></td><td class="nowrap mobileonly"><a href="../../campus/all/event.asp?gguid=0x29D0DDFC96DF4515B39D05C5C76A423F&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">PÜ</a></td><td class="nomobile"><a href="../../campus/all/event.asp?gguid=0x29D0DDFC96DF4515B39D05C5C76A423F&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Präsenz</a></td><td class="nowrap mobileonly"><a href="../../campus/all/event.asp?gguid=0x29D0DDFC96DF4515B39D05C5C76A423F&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">P</a></td><td class="icon"></td></tr><tr class="collapsible odd" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date failureApp">Di, 19:30 - 22:00</span>, <span class="room">Festsaal im Studentenhaus, Adenauerring 7</span></td></tr><tr class="collapsible odd" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date">Di (18.04.2023), 17:30 - 19:15</span>, <a href="../all/room.asp?gguid=0x86478B8850F8B84C83A882E3A59B03F9&amp;view=week&amp;date=2023-04-18&amp;appguid=0x8D5B2655F9DC49C2BEF4EA3E39501DB5&amp;evguid=0x29D0DDFC96DF4515B39D05C5C76A423F&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.95 Seminarraum Forum A und B</a></td></tr><tr class="collapsible odd" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date">Fr (21.04.2023), 19:30 - 22:00</span>, <a href="../all/room.asp?gguid=0x8352C75F466935449E9A7EA607302CD0&amp;view=week&amp;date=2023-04-21&amp;appguid=0x49518EE70CC1419B9C97A8E3D9965224&amp;evguid=0x29D0DDFC96DF4515B39D05C5C76A423F&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.95 Forum H&#246;rsaal (Audimax)</a></td></tr><tr class="collapsible odd" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date">Sa (22.04.2023), 09:30 - 17:00</span>, <a href="../all/room.asp?gguid=0x8352C75F466935449E9A7EA607302CD0&amp;view=week&amp;date=2023-04-22&amp;appguid=0x82AA299C40D54C7CA2D9C0B4DE3015B6&amp;evguid=0x29D0DDFC96DF4515B39D05C5C76A423F&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.95 Forum H&#246;rsaal (Audimax)</a></td></tr><tr class="collapsible odd" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date">Di (09.05.2023), 19:30 - 22:00</span>, <a href="../all/room.asp?gguid=0x8352C75F466935449E9A7EA607302CD0&amp;view=week&amp;date=2023-05-09&amp;appguid=0xED3706232E5A4B6FA70DD7D42A27A538&amp;evguid=0x29D0DDFC96DF4515B39D05C5C76A423F&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.95 Forum H&#246;rsaal (Audimax)</a></td></tr><tr class="collapsible odd" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date">Di (16.05.2023), 19:30 - 22:00</span>, <a href="../all/room.asp?gguid=0x8352C75F466935449E9A7EA607302CD0&amp;view=week&amp;date=2023-05-16&amp;appguid=0xBF30B6BECD5A4BECB070A60C36F2C183&amp;evguid=0x29D0DDFC96DF4515B39D05C5C76A423F&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.95 Forum H&#246;rsaal (Audimax)</a></td></tr><tr id="0x9075F151BAB64353853EE6399AFECCD4" class="even folding-close"><td class="folding-button-cell"><div class="folding-button"></div></td><td class="minwidth nowrap"><a href="../../campus/all/event.asp?gguid=0x9075F151BAB64353853EE6399AFECCD4&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">2110969</a></td><td class="rwev_titleger"><a href="../../campus/all/event.asp?gguid=0x9075F151BAB64353853EE6399AFECCD4&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Working Methods in Mechanical Engineering</a></td><td class="nomobile"><a href="../all/lecturer.asp?gguid=0x6AD34555BD140942B15347D5AE7DEBAB">Deml</a></td><td class="nomobile"><a href="../../campus/all/event.asp?gguid=0x9075F151BAB64353853EE6399AFECCD4&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Kurs</a></td><td class="nowrap mobileonly"><a href="../../campus/all/event.asp?gguid=0x9075F151BAB64353853EE6399AFECCD4&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Ku</a></td><td class="nomobile"><a href="../../campus/all/event.asp?gguid=0x9075F151BAB64353853EE6399AFECCD4&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Präsenz/Online gemischt</a></td><td class="nowrap mobileonly"><a href="../../campus/all/event.asp?gguid=0x9075F151BAB64353853EE6399AFECCD4&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">P+O</a></td><td class="icon"><a href="https://ilias.studium.kit.edu/goto.php?target=crs_2018363&amp;client_id=produktiv" title="FEHLENDER EINTRAG(campus2ilias.link.open)" target="_blank"><div class="campus2ilias-icon"></div></a></td></tr><tr class="collapsible even" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date">Fr (21.04.2023), 17:30 - 19:00</span>, <a href="../all/room.asp?gguid=0x8352C75F466935449E9A7EA607302CD0&amp;view=week&amp;date=2023-04-21&amp;appguid=0xEF1281B1E0664B37877CE7CEA7A92E42&amp;evguid=0x9075F151BAB64353853EE6399AFECCD4&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.95 Forum H&#246;rsaal (Audimax)</a></td></tr><tr id="0x82627023EE4546F8A5BECA21F5D46C50" class="odd folding-close"><td class="folding-button-cell"><div class="folding-button"></div></td><td class="minwidth nowrap"><a href="../../campus/all/event.asp?gguid=0x82627023EE4546F8A5BECA21F5D46C50&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">2146176</a></td><td class="rwev_titleger"><a href="../../campus/all/event.asp?gguid=0x82627023EE4546F8A5BECA21F5D46C50&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Methoden und Prozesse der PGE - Produktgenerationsentwicklung</a></td><td class="nomobile"><a href="../all/lecturer.asp?gguid=0x3F63F31E57F81F408696CA54739BBA3B">Albers</a>, <a href="../all/lecturer.asp?gguid=0xAF9DC126E1EC4860A2697DF59B26F0C1">D&#252;ser</a></td><td class="nomobile"><a href="../../campus/all/event.asp?gguid=0x82627023EE4546F8A5BECA21F5D46C50&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Vorlesung</a></td><td class="nowrap mobileonly"><a href="../../campus/all/event.asp?gguid=0x82627023EE4546F8A5BECA21F5D46C50&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">V</a></td><td class="nomobile"><a href="../../campus/all/event.asp?gguid=0x82627023EE4546F8A5BECA21F5D46C50&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Präsenz</a></td><td class="nowrap mobileonly"><a href="../../campus/all/event.asp?gguid=0x82627023EE4546F8A5BECA21F5D46C50&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">P</a></td><td class="icon"><a href="https://ilias.studium.kit.edu/goto.php?target=crs_2071907&amp;client_id=produktiv" title="FEHLENDER EINTRAG(campus2ilias.link.open)" target="_blank"><div class="campus2ilias-icon"></div></a></td></tr><tr class="collapsible odd" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date">Mo, 14:00 - 15:30</span>, <a href="../all/room.asp?gguid=0x8352C75F466935449E9A7EA607302CD0&amp;view=term&amp;appguid=0xA473ECC4BACF44FB8ABE65F0FFD65D60&amp;evguid=0x82627023EE4546F8A5BECA21F5D46C50&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.95 Forum H&#246;rsaal (Audimax)</a></td></tr><tr class="collapsible odd" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date failureApp">Fr, 14:00 - 15:30</span>, <a href="../all/room.asp?gguid=0x8352C75F466935449E9A7EA607302CD0&amp;view=term&amp;appguid=0xF04C27A40CD14D488529F4D638E07A2D&amp;evguid=0x82627023EE4546F8A5BECA21F5D46C50&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.95 Forum H&#246;rsaal (Audimax)</a></td></tr><tr class="collapsible odd" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date">Fr (21.07.2023), 14:00 - 15:30</span>, <a href="../all/room.asp?gguid=0x72DA8B7754F69F47A01C3E3102488CDD&amp;view=week&amp;date=2023-07-21&amp;appguid=0xE58ED1125CFF4D1081C044B5E31A131C&amp;evguid=0x82627023EE4546F8A5BECA21F5D46C50&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.21 Gerthsen-H&#246;rsaal</a>, <span class="comment">Ersatz f&#252;r Audimax HS Geb. 30.95</span></td></tr><tr class="collapsible odd" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date">Fr (28.07.2023), 14:00 - 15:30</span>, <a href="../all/room.asp?gguid=0x72DA8B7754F69F47A01C3E3102488CDD&amp;view=week&amp;date=2023-07-28&amp;appguid=0x546B5D068AD44DBFA45DDF52619FFEDB&amp;evguid=0x82627023EE4546F8A5BECA21F5D46C50&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.21 Gerthsen-H&#246;rsaal</a>, <span class="comment">Ersatz f&#252;r Audimax HS Geb. 30.95</span></td></tr><tr id="0x80817B0F9EA84BEC94FCB635B7A19DED" class="even folding-close"><td class="folding-button-cell"><div class="folding-button"></div></td><td class="minwidth nowrap"><a href="../../campus/all/event.asp?gguid=0x80817B0F9EA84BEC94FCB635B7A19DED&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">2150511</a></td><td class="rwev_titleger"><a href="../../campus/all/event.asp?gguid=0x80817B0F9EA84BEC94FCB635B7A19DED&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Produktentstehung - Bauteildimensionierung</a></td><td class="nomobile"><a href="../all/lecturer.asp?gguid=0x9044E6C76AE0A2418400A3BFFBC0190D">Schulze</a>, <a href="../all/lecturer.asp?gguid=0xE07AE54F65B5EA4893653DEDABBFB249">Dietrich</a></td><td class="nomobile"><a href="../../campus/all/event.asp?gguid=0x80817B0F9EA84BEC94FCB635B7A19DED&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Vorlesung / Übung</a></td><td class="nowrap mobileonly"><a href="../../campus/all/event.asp?gguid=0x80817B0F9EA84BEC94FCB635B7A19DED&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">VÜ</a></td><td class="nomobile"><a href="../../campus/all/event.asp?gguid=0x80817B0F9EA84BEC94FCB635B7A19DED&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Präsenz/Online gemischt</a></td><td class="nowrap mobileonly"><a href="../../campus/all/event.asp?gguid=0x80817B0F9EA84BEC94FCB635B7A19DED&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">P+O</a></td><td class="icon"><a href="https://ilias.studium.kit.edu/goto.php?target=crs_2058622&amp;client_id=produktiv" title="FEHLENDER EINTRAG(campus2ilias.link.open)" target="_blank"><div class="campus2ilias-icon"></div></a></td></tr><tr class="collapsible even" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date failureApp">Mo, 08:00 - 09:30</span>, <a href="../all/room.asp?gguid=0x8352C75F466935449E9A7EA607302CD0&amp;view=term&amp;appguid=0xF1E8FE2697714CC3A22B44DFD01B365F&amp;evguid=0x80817B0F9EA84BEC94FCB635B7A19DED&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.95 Forum H&#246;rsaal (Audimax)</a></td></tr><tr class="collapsible even" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date failureApp">Fr, 08:00 - 09:30</span>, <a href="../all/room.asp?gguid=0x8352C75F466935449E9A7EA607302CD0&amp;view=term&amp;appguid=0xD0DF49FB0B3B44479709C076F2570A22&amp;evguid=0x80817B0F9EA84BEC94FCB635B7A19DED&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.95 Forum H&#246;rsaal (Audimax)</a></td></tr><tr id="0x61444ABAFD3945329EA3917C876BF733" class="odd folding-close"><td class="folding-button-cell"><div class="folding-button"></div></td><td class="minwidth nowrap"><a href="../../campus/all/event.asp?gguid=0x61444ABAFD3945329EA3917C876BF733&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">2154512</a></td><td class="rwev_titleger"><a href="../../campus/all/event.asp?gguid=0x61444ABAFD3945329EA3917C876BF733&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Strömungslehre I</a></td><td class="nomobile"><a href="../all/lecturer.asp?gguid=0xA171FFAF2FB8C94682929D13EC29F9FB">Frohnapfel</a></td><td class="nomobile"><a href="../../campus/all/event.asp?gguid=0x61444ABAFD3945329EA3917C876BF733&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Vorlesung / Übung</a></td><td class="nowrap mobileonly"><a href="../../campus/all/event.asp?gguid=0x61444ABAFD3945329EA3917C876BF733&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">VÜ</a></td><td class="nomobile"><a href="../../campus/all/event.asp?gguid=0x61444ABAFD3945329EA3917C876BF733&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Präsenz/Online gemischt</a></td><td class="nowrap mobileonly"><a href="../../campus/all/event.asp?gguid=0x61444ABAFD3945329EA3917C876BF733&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">P+O</a></td><td class="icon"><a href="https://ilias.studium.kit.edu/goto.php?target=crs_2059880&amp;client_id=produktiv" title="FEHLENDER EINTRAG(campus2ilias.link.open)" target="_blank"><div class="campus2ilias-icon"></div></a></td></tr><tr class="collapsible odd" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date failureApp">Do, 11:30 - 13:00</span>, <a href="../all/room.asp?gguid=0x8352C75F466935449E9A7EA607302CD0&amp;view=term&amp;appguid=0x31594B84B0C74CAABCAB68189BE9C3A1&amp;evguid=0x61444ABAFD3945329EA3917C876BF733&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.95 Forum H&#246;rsaal (Audimax)</a></td></tr><tr class="collapsible odd" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date failureApp">Fr, 11:30 - 13:00</span>, <a href="../all/room.asp?gguid=0x8352C75F466935449E9A7EA607302CD0&amp;view=term&amp;appguid=0x536FC769A0B44D6BB2430B961B3D95E0&amp;evguid=0x61444ABAFD3945329EA3917C876BF733&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.95 Forum H&#246;rsaal (Audimax)</a></td></tr><tr id="0x21E34F3E44754D5FA2CDDA45E77411F6" class="even folding-close"><td class="folding-button-cell"><div class="folding-button"></div></td><td class="minwidth nowrap"><a href="../../campus/all/event.asp?gguid=0x21E34F3E44754D5FA2CDDA45E77411F6&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">2162251</a></td><td class="rwev_titleger"><a href="../../campus/all/event.asp?gguid=0x21E34F3E44754D5FA2CDDA45E77411F6&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Übungen zu Technische Mechanik II</a></td><td class="nomobile"><a href="../all/lecturer.asp?gguid=0xB328E0D951EF4A08BD026672F2F564CF">Dyck</a>, <a href="../all/lecturer.asp?gguid=0x07295863926B4F569F4F485CA32A9F7D">Sterr</a>, <a href="../all/lecturer.asp?gguid=0xB9B11B6CBFBA824CAEDE7DC96EF44806">B&#246;hlke</a></td><td class="nomobile"><a href="../../campus/all/event.asp?gguid=0x21E34F3E44754D5FA2CDDA45E77411F6&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Übung</a></td><td class="nowrap mobileonly"><a href="../../campus/all/event.asp?gguid=0x21E34F3E44754D5FA2CDDA45E77411F6&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Ü</a></td><td class="nomobile"><a href="../../campus/all/event.asp?gguid=0x21E34F3E44754D5FA2CDDA45E77411F6&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Präsenz</a></td><td class="nowrap mobileonly"><a href="../../campus/all/event.asp?gguid=0x21E34F3E44754D5FA2CDDA45E77411F6&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">P</a></td><td class="icon"></td></tr><tr class="collapsible even" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date failureApp">Fr, 09:45 - 11:15</span>, <a href="../all/room.asp?gguid=0x8352C75F466935449E9A7EA607302CD0&amp;view=term&amp;appguid=0x59C7D0B3815440A59C9E13779381019D&amp;evguid=0x21E34F3E44754D5FA2CDDA45E77411F6&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.95 Forum H&#246;rsaal (Audimax)</a></td></tr><tr class="collapsible even" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date">Fr (21.07.2023), 15:45 - 17:15</span>, <a href="../all/room.asp?gguid=0x72DA8B7754F69F47A01C3E3102488CDD&amp;view=week&amp;date=2023-07-21&amp;appguid=0x81D6C30C0A4B4D4BAE389944FCE30BAE&amp;evguid=0x21E34F3E44754D5FA2CDDA45E77411F6&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.21 Gerthsen-H&#246;rsaal</a>, <span class="comment">Ersatz f&#252;r Audimax HS Geb. 30.95</span></td></tr><tr id="0x2E9917E3708F4A988F7144D098876A80" class="odd folding-close"><td class="folding-button-cell"><div class="folding-button"></div></td><td class="minwidth nowrap"><a href="../../campus/all/event.asp?gguid=0x2E9917E3708F4A988F7144D098876A80&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">2174970</a></td><td class="rwev_titleger"><a href="../../campus/all/event.asp?gguid=0x2E9917E3708F4A988F7144D098876A80&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Arbeitstechniken im Maschinenbau</a></td><td class="nomobile"><a href="../all/lecturer.asp?gguid=0x6AD34555BD140942B15347D5AE7DEBAB">Deml</a></td><td class="nomobile"><a href="../../campus/all/event.asp?gguid=0x2E9917E3708F4A988F7144D098876A80&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Kurs</a></td><td class="nowrap mobileonly"><a href="../../campus/all/event.asp?gguid=0x2E9917E3708F4A988F7144D098876A80&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Ku</a></td><td class="nomobile"><a href="../../campus/all/event.asp?gguid=0x2E9917E3708F4A988F7144D098876A80&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Präsenz/Online gemischt</a></td><td class="nowrap mobileonly"><a href="../../campus/all/event.asp?gguid=0x2E9917E3708F4A988F7144D098876A80&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">P+O</a></td><td class="icon"><a href="https://ilias.studium.kit.edu/goto.php?target=crs_2018362&amp;client_id=produktiv" title="FEHLENDER EINTRAG(campus2ilias.link.open)" target="_blank"><div class="campus2ilias-icon"></div></a></td></tr><tr class="collapsible odd" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date failureApp">Fr (14 tgl.), 15:45 - 17:15</span>, <a href="../all/room.asp?gguid=0x8352C75F466935449E9A7EA607302CD0&amp;view=term&amp;appguid=0x4518D4CE73EE447B8AE43B85E2ACAEF7&amp;evguid=0x2E9917E3708F4A988F7144D098876A80&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.95 Forum H&#246;rsaal (Audimax)</a></td></tr><tr id="0xE22A0F8888F347269F6F0E7B824AF4C0" class="even folding-close"><td class="folding-button-cell"><div class="folding-button"></div></td><td class="minwidth nowrap"><a href="../../campus/all/event.asp?gguid=0xE22A0F8888F347269F6F0E7B824AF4C0&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">3146023</a></td><td class="rwev_titleger"><a href="../../campus/all/event.asp?gguid=0xE22A0F8888F347269F6F0E7B824AF4C0&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Methods and Processes of PGE - Product Generation Engineering</a></td><td class="nomobile"><a href="../all/lecturer.asp?gguid=0x3F63F31E57F81F408696CA54739BBA3B">Albers</a>, <a href="../all/lecturer.asp?gguid=0x9C9E8FC3107BFF49AC9857390E594B7B">Burkardt</a></td><td class="nomobile"><a href="../../campus/all/event.asp?gguid=0xE22A0F8888F347269F6F0E7B824AF4C0&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Vorlesung</a></td><td class="nowrap mobileonly"><a href="../../campus/all/event.asp?gguid=0xE22A0F8888F347269F6F0E7B824AF4C0&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">V</a></td><td class="nomobile"><a href="../../campus/all/event.asp?gguid=0xE22A0F8888F347269F6F0E7B824AF4C0&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">Präsenz</a></td><td class="nowrap mobileonly"><a href="../../campus/all/event.asp?gguid=0xE22A0F8888F347269F6F0E7B824AF4C0&amp;searchid=003127481831&amp;tguid=0x40B784B43AED4CC9857335104533EDFB">P</a></td><td class="icon"></td></tr><tr class="collapsible even" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date">Mo, 14:00 - 15:30</span>, <a href="../all/room.asp?gguid=0x8352C75F466935449E9A7EA607302CD0&amp;view=term&amp;appguid=0x5BF3A299C48F4B9E8F552292FC88AD5D&amp;evguid=0xE22A0F8888F347269F6F0E7B824AF4C0&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.95 Forum H&#246;rsaal (Audimax)</a></td></tr><tr class="collapsible even" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date failureApp">Fr, 14:00 - 15:30</span>, <a href="../all/room.asp?gguid=0x8352C75F466935449E9A7EA607302CD0&amp;view=term&amp;appguid=0x05DE3286DD264B2DB69C17278D6882D1&amp;evguid=0xE22A0F8888F347269F6F0E7B824AF4C0&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.95 Forum H&#246;rsaal (Audimax)</a></td></tr><tr class="collapsible even" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date">Fr (21.07.2023), 14:00 - 15:30</span>, <a href="../all/room.asp?gguid=0x72DA8B7754F69F47A01C3E3102488CDD&amp;view=week&amp;date=2023-07-21&amp;appguid=0xDD9B92DAAF184BD5BC13F55690D3CA75&amp;evguid=0xE22A0F8888F347269F6F0E7B824AF4C0&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.21 Gerthsen-H&#246;rsaal</a>, <span class="comment">Ersatz f&#252;r Audimax HS Geb. 30.95</span></td></tr><tr class="collapsible even" style="display: none"><td> </td><td class="collapsible" colspan="17"><span class="date">Fr (28.07.2023), 14:00 - 15:30</span>, <a href="../all/room.asp?gguid=0x72DA8B7754F69F47A01C3E3102488CDD&amp;view=week&amp;date=2023-07-28&amp;appguid=0x049FC2E173A642ABB4A71E33A9391C20&amp;evguid=0xE22A0F8888F347269F6F0E7B824AF4C0&amp;tguid=0x40B784B43AED4CC9857335104533EDFB" class="room">30.21 Gerthsen-H&#246;rsaal</a>, <span class="comment">Ersatz f&#252;r Audimax HS Geb. 30.95</span></td></tr></tbody></table></div><div class="pagination"><div class="pagination-count">Einträge 1 - 8 von 8</div><div class="pagination-itemsperpage"><select class="itemsperpage" size="1" name="pagesize"><option value="10">10</option><option value="25" selected="selected">25</option><option value="50">50</option><option value="100">100</option><option value="200">200</option></select> Einträge pro Seite</div></div><input name="sortcolumn" type="hidden" value="1" /><input name="sortorder" type="hidden" value="up" /><div class="tablelegend"><p class="failureApp">Aus dieser Serie wurden Termine entfernt.</p></div></div></div><script type="text/javascript" nonce="">
    $('button#printpage').on('click', function(e) { e.preventDefault(); self.print(); });
  </script></div></form><div class="serverinfo noprint">scc-cas-prod05 (609ms)</div></body></html><!-- asp: 609,375 ms, xslt: 46,875 ms on host SCC-CAS-PROD05 -->
`;

interface RawTerm {
    tstart: number,
    tend: number,
}

interface Term {
    start: Date,
    end: Date,
    id: string,
}

const i_promise_terms = new Promise<Term[]>((resolve, reject) => {
    make_request(TERMS_URL, {}, {}, false)
        .then(response => response.json())
        .then((json: { [id: string]: RawTerm }) => {
            const terms = [];
            for (const id in json) {
                const term = json[id];
                terms.push({
                    start: new Date(term.tstart),
                    end: new Date(term.tend),
                    id: id
                });
            }
            resolve(terms);
        })
        .catch(error => reject(error));

});

const get_term_id = async (date: Date): Promise<string> => {
    const terms = await i_promise_terms;
    for (const term of terms) {
        if (date >= term.start && date <= term.end) {
            return term.id;
        }
    }
    throw new Error("No term found for the given date.");
}

/**
 * Makes a request to the cors proxy to avoid CORS issues with the KIT endpoint.
 * @param url The url to make the request to.
 * @param form_data The form data to send.
 * @param headers The headers to send.
 * @param cache Whether to cache the response.
 * @returns The response.
 *
 * @see https://github.com/MatthiasHarzer/minimal-cors-server
 */
function make_request(url: string, form_data?: object, headers?: object, cache?: boolean): Promise<Response> {
    const body: CorsProxyBody = {
        method: "POST",
        url: url,
        data: form_data,
        headers: headers,
        cache: cache ?? true
    }

    return fetch(CORS_PROXY_SERVER, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(body)
    })
}

/**
 * Gets all events from the KIT endpoint matching the config.
 * @param config The config.
 * @returns The events.
 */
export const get_events = async (config: KITEventsConfig): Promise<KITEvent[]> => {
    const json_form_data = {...DEFAULT_FORM_DATA};

    json_form_data.tguid = await get_term_id(config.day);
    json_form_data.appointmentdate = format_date(config.day, "#DD#.#MM#.#YYYY#");
    json_form_data.appointmenttimestart = config.time;
    json_form_data.appointmenttimeend = END_TIMES[config.time];

    const response = await make_request(BASE_URL, json_form_data, REQUEST_HEADERS);
    const text = await response.text();

    const time_span = `${config.time} - ${END_TIMES[config.time]}`
    const day_short_hand = config.day.toLocaleDateString("de-DE", {weekday: "short"});

    const parser = new Parser(text, config.day, {
        target_time: time_span,
    });
    const events = parser.get_all_events()
        .filter((event) => {
            return event.occurrences.some(occ=>occ.matches(config));
        });
    if (config.types.length === 0) return events;
    return events.filter((event) => config.types.includes(event.type));
}


